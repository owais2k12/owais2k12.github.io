I"—6<p>åœ¨Djangoä¸­çš„settings.pyä¸­å¯ä»¥ä¿®æ”¹130å¤šé¡¹è®¾ç½®, ä½†å¤§å¤šæ•°éƒ½ç»§æ‰¿è‡ªé»˜è®¤å€¼. è®¾ç½®æ˜¯åœ¨webæœåŠ¡å™¨å¯åŠ¨æ—¶é¦–æ¬¡è½½å…¥çš„, æœåŠ¡å™¨é‡å¯æ—¶é‡æ–°è½½å…¥, å› æ­¤, ç¨‹åºå‘˜ä»¬åº”å°½é‡é¿å…ä¿®æ”¹æ­£å¼æœåŠ¡å™¨ä¸Šä½¿ç”¨çš„settings.pyæ–‡ä»¶. ä»¥ä¸‹æ˜¯ä¸€äº›æˆ‘ä»¬åº”å½“éµå¾ªçš„åŸåˆ™:</p>

<ul>
  <li>æ‰€æœ‰çš„è®¾ç½®æ–‡ä»¶åº”å½“è¿›è¡Œç‰ˆæœ¬ç®¡ç†</li>
  <li>ä¸è¦é‡å¤è‡ªå·± (donâ€™t repeat yourself)</li>
  <li>å¦¥å–„ä¿å­˜å…³é”®ä¿¡æ¯</li>
</ul>

<p>ä¹‹å‰, æˆ‘ä»¬é‡‡ç”¨çš„æ–¹æ³•æ˜¯, ä¸å°†è®¾ç½®æ–‡ä»¶æ”¾å…¥gitåº“ä¸­, æ¯ä¸ªå¼€å‘äººå‘˜æœ¬åœ°æœ‰ä¸€ä»½è‡ªå·±çš„è®¾ç½®æ–‡ä»¶. ä½†æˆ‘ä»¬å‘ç°è¿™æ ·åšæ˜¯é”™è¯¯çš„. å› ä¸º:</p>

<ul>
  <li>åœ¨debugä¹‹å‰, æˆ‘ä»¬å¯èƒ½å·²ç»èŠ±è´¹äº†å¤§é‡ç²¾åŠ›å»æ¨¡æ‹Ÿæ­£å¼æœåŠ¡å™¨ä¸Šå‡ºç°çš„é”™è¯¯, ä½†æœ€ç»ˆå‘ç°è¿™æ˜¯ç”±äºæ­£å¼æœåŠ¡å™¨çš„settingsæ–‡ä»¶è®¾ç½®å’Œæœ¬åœ°ä¸åŒè€Œ å‡ºç°çš„é—®é¢˜. è¿™æ—¶ä½ çš„å¿ƒæƒ…ä¼šæ˜¯æ€æ ·?</li>
  <li>å½“ä½ åœ¨å¼€å‘djangoé¡¹ç›®æ—¶, å‘ç°å¹¶ä¿®å¤äº†ä¸€ä¸ªbug. å½“å°†è¿™ä¸€commit pushåˆ°æœåŠ¡å™¨å, ä½ çªç„¶å‘ç°è¿™ä¸€bugçš„å‡ºç°å®Œå…¨æ˜¯å› ä¸ºä½ ä¿®æ”¹äº†æœ¬åœ°çš„ settingsæ–‡ä»¶è€Œäº§ç”Ÿçš„, è€Œç”±äºä½ çš„push, åˆå¯¼è‡´äº†æœåŠ¡å™¨çš„å®•æœº. è¿™æ—¶ä½ åˆä¼šæ˜¯æ€æ ·çš„æ„Ÿå—?</li>
  <li>æ¯ä¸ªäººéƒ½ä¼šä»å¦ä¸€ä¸ªç¨‹åºå‘˜é‚£é‡Œæ‹·è´/é»è´´settingsæ–‡ä»¶å†…å®¹, è¿™éš¾é“ä¸æ˜¯è¿åäº†â€ä¸è¦é‡å¤è‡ªå·±â€çš„åŸåˆ™å—?</li>
</ul>

<p>æ­£å¼ç”±äºè¿™äº›é—®é¢˜, æ‰€ä»¥æˆ‘ä»¬ç°åœ¨é‡‡ç”¨ä¸ä¸€æ ·çš„è®¾ç½®æ–¹å¼. æˆ‘ä»¬é¦–å…ˆå»ºç«‹ä¸€ä¸ªåŸºæœ¬çš„è®¾ç½®æ–‡ä»¶, ç„¶åå°†å¼€å‘å’Œæ­£å¼éƒ¨ç½²çš„è®¾ç½®æ–‡ä»¶åˆ†ç¦»æˆä¸åŒçš„æ¨¡å—, ä½† è¿™äº›æ¨¡å—éƒ½ç»§æ‰¿è‡ªåŒä¸€ä¸ªåŸºæœ¬è®¾ç½®æ–‡ä»¶:</p>

<h4 id="ä½¿ç”¨åˆ†ç¦»å¼çš„è®¾ç½®æ–‡ä»¶">ä½¿ç”¨åˆ†ç¦»å¼çš„è®¾ç½®æ–‡ä»¶</h4>
<p>djangoé¡¹ç›®å»ºç«‹æ—¶, ä¼šè‡ªåŠ¨ç”Ÿæˆsettings.pyæ–‡ä»¶. ä¸ºäº†å®ç°åˆ†ç¦»å¼çš„è®¾ç½®æ–‡ä»¶, æˆ‘ä»¬é¦–å…ˆåˆ é™¤settings.py, ç„¶åå»ºç«‹settingsç›®å½•:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>settings/
        __init__.py
        base.py
        local.py
        test.py
        production.py
        ...
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th style="text-align: left">è®¾ç½®æ–‡ä»¶</th>
      <th style="text-align: left">ç›®çš„</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">base.py</td>
      <td style="text-align: left">åŸºæœ¬è®¾ç½®æ–‡ä»¶, åœ¨å„ä¸ªç¯å¢ƒä¸­éƒ½ç›¸åŒçš„è®¾ç½®å¯ä»¥æ”¾å…¥å…¶ä¸­.</td>
    </tr>
    <tr>
      <td style="text-align: left">dev.py</td>
      <td style="text-align: left">å½“åœ¨å¼€å‘æ—¶ä½¿ç”¨çš„è®¾ç½®æ–‡ä»¶. å¯ä»¥è®¾ç½®å¼€å‘æ—¶çš„é€‰é¡¹, åŒ…æ‹¬DEBUG, logçš„ç­‰çº§, æ˜¯å¦å¼€å¯ä¾‹å¦‚ django-debug-toolbarç­‰å¼€å‘å·¥å…·ç­‰.</td>
    </tr>
    <tr>
      <td style="text-align: left">test.py</td>
      <td style="text-align: left">è¿è¡Œtestæ—¶çš„é…ç½®, åŒ…æ‹¬test runners, in-memoryæ•°æ®åº“å®šä¹‰å’Œlogè®¾ç½®ç­‰.</td>
    </tr>
    <tr>
      <td style="text-align: left">product.py</td>
      <td style="text-align: left">å½“éƒ¨ç½²åˆ°æ­£å¼æœåŠ¡å™¨ä¸Šæ‰€ç”¨çš„è®¾ç½®.</td>
    </tr>
  </tbody>
</table>

<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä½¿ç”¨è¿™äº›ä¸åŒçš„è®¾ç½®æ–‡ä»¶:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python manage.py shell --settings=mysite.settings.local
python manage.py runserver --settings=mysite.settings.local
</code></pre></div></div>

<p>å½“ç„¶å¦‚æœä½ ç†Ÿæ‚‰ DJANGO_SETTINGS_MODULE å’Œ PYTHONPATH çš„è¯, ä¹Ÿå¯ä»¥äº‹å…ˆè®¾ç½®å¥½ DJANGO_SETTINGS_MODULE å’Œ PYTHONPATH ç¯å¢ƒå˜é‡, è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯ä½ ä¸å¿…ä½¿ç”¨â€“settingsäº†.</p>

<p>å¦‚æœä½ å¯¹virtualenvæœ‰æ·±å…¥çš„äº†è§£çš„è¯, ä¹Ÿå¯ä»¥åœ¨postactivateè„šæœ¬ä¸­è®¾ç½® DJANGO_SETTINGS_MODULE å’Œ PYTHONPATH.</p>

<p>è¿™é‡Œæˆ‘ä½¿ç”¨äº†test.pyå’Œproduct.pyæ¥åŒºåˆ†ä¸¤ä¸ªä¸åŒçš„é…ç½®ï¼š</p>

<p><img src="http://www.jack003.com/static/img/blog/django_settings/tree.jpg" alt="tree" /></p>

<p>å…ˆçœ‹__init__.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">platform</span>

<span class="k">if</span> <span class="n">platform</span><span class="p">.</span><span class="n">node</span><span class="p">()</span> <span class="o">==</span> <span class="s">"94_54"</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">base</span> <span class="kn">import</span> <span class="o">*</span>
    <span class="kn">from</span> <span class="nn">product</span> <span class="kn">import</span> <span class="o">*</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">base</span> <span class="kn">import</span> <span class="o">*</span>
    <span class="kn">from</span> <span class="nn">test</span> <span class="kn">import</span> <span class="o">*</span>
</code></pre></div></div>

<p>å…¶ä¸­â€94_54â€æ˜¯æ­£å¼ç¯å¢ƒçš„æœåŠ¡å™¨çš„ä¸»æœºåï¼Œå¯ä»¥ç”¨hostnameå‘½ä»¤æŸ¥çœ‹åˆ°</p>

<p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸åŒçš„pyæ–‡ä»¶ä¸­ï¼ˆproductï¼Œtestï¼‰æ”¾å…¥ä¸åŒçš„é…ç½®ï¼Œå¦‚æ•°æ®åº“è¿æ¥ï¼Œå…¶ä»–ç™»é™†ä¿¡æ¯ã€‚</p>

<p>ä»Šåä»ä»“åº“ä¸­æ‹‰å–ä»£ç å’Œä»é›†æˆå¼€å‘ç¯å¢ƒä¸­ç›´æ¥æ‰“åŒ…ä»£ç æ–‡ä»¶å°±å¯ä»¥ç›´æ¥æ”¾å…¥æµ‹è¯•ç¯å¢ƒæˆ–è€…æ­£å¼ç¯å¢ƒä½¿ç”¨äº†ã€‚</p>

<p>base.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"""
Django settings for saplatform project.

Generated by 'django-admin startproject' using Django 1.8.

For more information on this file, see
https://docs.djangoproject.com/en/1.8/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/1.8/ref/settings/
"""</span>

<span class="c1"># Build paths inside the project like this: os.path.join(BASE_DIR, ...)
</span><span class="kn">import</span> <span class="nn">os</span>

<span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">))))</span>

<span class="c1"># Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/1.8/howto/deployment/checklist/
</span>
<span class="c1"># SECURITY WARNING: keep the secret key used in production secret!
</span><span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'za5nj^ga!a$+t8rg%9kq8j8)1ig7=s!#g!p&amp;_$x9##8%#u0$--'</span>

<span class="c1"># SECURITY WARNING: don't run with debug turned on in production!
</span><span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Application definition
</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">'django.contrib.admin'</span><span class="p">,</span>
    <span class="s">'django.contrib.auth'</span><span class="p">,</span>
    <span class="s">'django.contrib.contenttypes'</span><span class="p">,</span>
    <span class="s">'django.contrib.sessions'</span><span class="p">,</span>
    <span class="s">'django.contrib.messages'</span><span class="p">,</span>
    <span class="s">'django.contrib.staticfiles'</span><span class="p">,</span>
    <span class="s">'app'</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">MIDDLEWARE_CLASSES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">'django.contrib.sessions.middleware.SessionMiddleware'</span><span class="p">,</span>
    <span class="s">'django.middleware.common.CommonMiddleware'</span><span class="p">,</span>
    <span class="s">'django.middleware.locale.LocaleMiddleware'</span><span class="p">,</span>
    <span class="s">'django.middleware.csrf.CsrfViewMiddleware'</span><span class="p">,</span>
    <span class="s">'django.contrib.auth.middleware.AuthenticationMiddleware'</span><span class="p">,</span>
    <span class="s">'django.contrib.auth.middleware.SessionAuthenticationMiddleware'</span><span class="p">,</span>
    <span class="s">'django.contrib.messages.middleware.MessageMiddleware'</span><span class="p">,</span>
    <span class="s">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span><span class="p">,</span>
    <span class="s">'django.middleware.security.SecurityMiddleware'</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ROOT_URLCONF</span> <span class="o">=</span> <span class="s">'saplatform.urls'</span>

<span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s">'BACKEND'</span><span class="p">:</span> <span class="s">'django.template.backends.django.DjangoTemplates'</span><span class="p">,</span>
        <span class="s">'DIRS'</span><span class="p">:</span> <span class="p">[</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">'templates'</span><span class="p">)]</span>
        <span class="p">,</span>
        <span class="s">'APP_DIRS'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s">'OPTIONS'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">'context_processors'</span><span class="p">:</span> <span class="p">[</span>
                <span class="s">'django.template.context_processors.debug'</span><span class="p">,</span>
                <span class="s">'django.template.context_processors.request'</span><span class="p">,</span>
                <span class="s">'django.contrib.auth.context_processors.auth'</span><span class="p">,</span>
                <span class="s">'django.contrib.messages.context_processors.messages'</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">WSGI_APPLICATION</span> <span class="o">=</span> <span class="s">'saplatform.wsgi.application'</span>

<span class="c1"># Database
# https://docs.djangoproject.com/en/1.8/ref/settings/#databases
</span>
<span class="c1"># see test.py &amp;&amp; product.py
</span>
<span class="c1"># Internationalization
# https://docs.djangoproject.com/en/1.8/topics/i18n/
</span>
<span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s">'zh-hans'</span>

<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s">'Asia/Shanghai'</span>

<span class="n">USE_I18N</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">USE_L10N</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">USE_TZ</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c1"># Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/1.8/howto/static-files/
</span>
<span class="n">LOGIN_URL</span> <span class="o">=</span> <span class="s">'/users/login/'</span>

<span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s">'/static/'</span>

<span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">'static'</span><span class="p">),)</span>

<span class="c1"># SESSION_COOKIE_AGE = 60 * 10
</span><span class="n">SESSION_EXPIRE_AT_BROWSER_CLOSE</span> <span class="o">=</span> <span class="bp">True</span>

</code></pre></div></div>

<p>base.pyä¸­éœ€è¦æ³¨æ„è°ƒæ•´çš„æ˜¯BASE_DIRå˜é‡ï¼Œéœ€è¦å¥—ä¸€å±‚os.path.dirname()å‡½æ•°ï¼Œå› ä¸ºæ˜¯åœ¨settingsç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚</p>

<p>test.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">base</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'default'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'ENGINE'</span><span class="p">:</span> <span class="s">'django.db.backends.mysql'</span><span class="p">,</span>
        <span class="s">'NAME'</span><span class="p">:</span> <span class="s">'******'</span><span class="p">,</span>
        <span class="s">'USER'</span><span class="p">:</span> <span class="s">'***'</span><span class="p">,</span>
        <span class="s">'PASSWORD'</span><span class="p">:</span> <span class="s">'******'</span><span class="p">,</span>
        <span class="s">'HOST'</span><span class="p">:</span> <span class="s">'***.***.***.***'</span><span class="p">,</span>
        <span class="s">'PORT'</span><span class="p">:</span> <span class="s">'3306'</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">SALTAPI_URL</span> <span class="o">=</span> <span class="s">'https://127.0.0.1:8000'</span>

<span class="n">SALTAPI_USER</span> <span class="o">=</span> <span class="s">'****'</span>

<span class="n">SALTAPI_PASSWORD</span> <span class="o">=</span> <span class="s">'****'</span>
</code></pre></div></div>
:ET